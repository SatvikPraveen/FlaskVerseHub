<!-- File: FlaskVerseHub/app/templates/macros/form_macros.html -->

{# Render a complete form field with label, input, and errors #} {% macro
render_field(field, class_='', placeholder='', help_text='', show_label=true,
required=false) %}
<div class="mb-3 {% if field.errors %}has-error{% endif %}">
  {% if show_label and field.label %}
  <label
    for="{{ field.id }}"
    class="form-label {% if required or field.flags.required %}required{% endif %}"
  >
    {{ field.label.text }} {% if required or field.flags.required %}<span
      class="text-danger"
      >*</span
    >{% endif %}
  </label>
  {% endif %}

  <div class="form-input-wrapper">
    {% if field.type == 'TextAreaField' %} {{ field(class="form-control " +
    class_, placeholder=placeholder or field.description,
    rows=field.render_kw.rows if field.render_kw and field.render_kw.rows else
    4) }} {% elif field.type == 'SelectField' %} {{ field(class="form-select " +
    class_) }} {% elif field.type == 'BooleanField' %}
    <div class="form-check">
      {{ field(class="form-check-input") }} {% if field.label %}
      <label for="{{ field.id }}" class="form-check-label"
        >{{ field.label.text }}</label
      >
      {% endif %}
    </div>
    {% elif field.type == 'FileField' %} {{ field(class="form-control " +
    class_, accept=field.render_kw.accept if field.render_kw and
    field.render_kw.accept else '') }} {% elif field.type == 'PasswordField' %}
    <div class="input-group">
      {{ field(class="form-control " + class_, placeholder=placeholder or 'Enter
      password') }}
      <button
        type="button"
        class="btn btn-outline-secondary"
        onclick="togglePassword('{{ field.id }}')"
      >
        <i class="fas fa-eye" id="{{ field.id }}-toggle-icon"></i>
      </button>
    </div>
    {% else %} {{ field(class="form-control " + class_, placeholder=placeholder
    or field.description) }} {% endif %} {% if help_text %}
    <div class="form-text">{{ help_text }}</div>
    {% endif %}
  </div>

  {% if field.errors %}
  <div class="invalid-feedback d-block">
    {% for error in field.errors %}
    <div class="text-danger">{{ error }}</div>
    {% endfor %}
  </div>
  {% endif %}
</div>
{% endmacro %} {# Render form buttons #} {% macro
render_form_buttons(submit_text='Submit', cancel_url='', show_cancel=true,
additional_buttons=[]) %}
<div class="form-actions d-flex gap-2 justify-content-end mt-4 pt-3 border-top">
  <button type="submit" class="btn btn-primary">
    <i class="fas fa-check me-1"></i>
    {{ submit_text }}
  </button>

  {% if show_cancel and cancel_url %}
  <a href="{{ cancel_url }}" class="btn btn-secondary">
    <i class="fas fa-times me-1"></i>
    Cancel
  </a>
  {% endif %} {% for button in additional_buttons %}
  <button
    type="{{ button.type or 'button' }}"
    class="btn {{ button.class or 'btn-outline-secondary' }}"
    {%
    if
    button.onclick
    %}onclick="{{ button.onclick }}"
    {%
    endif
    %}
  >
    {% if button.icon %}<i class="{{ button.icon }} me-1"></i>{% endif %} {{
    button.text }}
  </button>
  {% endfor %}
</div>
{% endmacro %} {# Render hidden CSRF token #} {% macro render_csrf_token(form)
%} {% if form.csrf_token %} {{ form.csrf_token }} {% endif %} {% endmacro %} {#
Render complete form #} {% macro render_form(form, action='', method='POST',
enctype='', submit_text='Submit', cancel_url='', show_cancel=true,
form_class='') %}
<form
  action="{{ action }}"
  method="{{ method }}"
  {%
  if
  enctype
  %}enctype="{{ enctype }}"
  {%
  endif
  %}
  class="needs-validation {{ form_class }}"
  novalidate
>
  {{ render_csrf_token(form) }} {% for field in form if field.name !=
  'csrf_token' and field.name != 'submit' %} {{ render_field(field,
  required=field.flags.required) }} {% endfor %} {{
  render_form_buttons(submit_text=submit_text, cancel_url=cancel_url,
  show_cancel=show_cancel) }}
</form>
{% endmacro %} {# Render inline form (for quick actions) #} {% macro
render_inline_form(form, action='', method='POST', submit_text='Submit',
form_class='') %}
<form
  action="{{ action }}"
  method="{{ method }}"
  class="d-flex align-items-center gap-2 {{ form_class }}"
>
  {{ render_csrf_token(form) }} {% for field in form if field.name !=
  'csrf_token' and field.name != 'submit' %} {% if field.type == 'HiddenField'
  %} {{ field() }} {% else %}
  <div class="flex-grow-1">
    {{ field(class="form-control", placeholder=field.label.text) }}
  </div>
  {% endif %} {% endfor %}

  <button type="submit" class="btn btn-primary">{{ submit_text }}</button>
</form>
{% endmacro %} {# Render search form #} {% macro render_search_form(form,
placeholder='Search...', action='') %}
<form action="{{ action }}" method="GET" class="search-form">
  <div class="input-group">
    {% for field in form if field.name != 'csrf_token' %} {% if field.type ==
    'StringField' %} {{ field(class="form-control", placeholder=placeholder) }}
    {% elif field.type == 'SelectField' %} {{ field(class="form-select") }} {%
    else %} {{ field(class="form-control") }} {% endif %} {% endfor %}
    <button type="submit" class="btn btn-outline-primary">
      <i class="fas fa-search"></i>
      <span class="visually-hidden">Search</span>
    </button>
  </div>
</form>
{% endmacro %} {# Render form validation summary #} {% macro
render_form_errors(form) %} {% if form.errors %}
<div class="alert alert-danger">
  <h5 class="alert-heading">
    <i class="fas fa-exclamation-triangle me-2"></i>
    Please correct the following errors:
  </h5>
  <ul class="mb-0">
    {% for field_name, errors in form.errors.items() %} {% for error in errors
    %}
    <li>{{ form[field_name].label.text }}: {{ error }}</li>
    {% endfor %} {% endfor %}
  </ul>
</div>
{% endif %} {% endmacro %} {# File upload with drag and drop #} {% macro
render_file_upload(field, multiple=false, accept='') %}
<div class="file-upload-area" data-field="{{ field.id }}">
  <div
    class="drop-zone border-2 border-dashed border-secondary rounded p-4 text-center"
    ondrop="handleFileDrop(event, '{{ field.id }}')"
    ondragover="handleDragOver(event)"
    ondragleave="handleDragLeave(event)"
  >
    <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
    <p class="mb-2">
      Drag and drop files here, or
      <a
        href="#"
        onclick="document.getElementById('{{ field.id }}').click(); return false;"
        >browse</a
      >
    </p>
    <small class="text-muted"
      >{{ accept if accept else 'All file types accepted' }}</small
    >
    {{ field(class="d-none", multiple=multiple, accept=accept,
    onchange="handleFileSelect(event)") }}
  </div>
  <div class="file-preview mt-3 d-none" id="{{ field.id }}-preview"></div>
</div>
{% endmacro %}
